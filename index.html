<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta id="themeColor" name="theme-color" content="#0f131c" />
    <title>App Survival: Android Release Night</title>
  </head>
  <body>
    <div id="app" class="wrap">
      <div class="canvasWrap" aria-label="Architecture canvas">
        <canvas id="c"></canvas>
        <div class="canvasHud" role="group" aria-label="Canvas controls">
          <button id="btnZoomOut" class="btn hud" data-i18n-title="canvas.zoomOut" title="Zoom out">‚àí</button>
          <button id="btnZoomIn" class="btn hud" data-i18n-title="canvas.zoomIn" title="Zoom in">+</button>
          <button id="btnZoomFit" class="btn hud" data-i18n-title="canvas.fit" title="Fit">‚§¢</button>
        </div>
      </div>

      <aside class="side" aria-label="Dashboard">
        <div class="sideHeader">
          <h1><span data-i18n="app.title">App Survival: Android Release Night</span> <span class="badge" data-i18n="app.badge">M3 ‚Ä¢ TS + Vite</span></h1>

          <div class="row">
            <button id="btnStart" class="btn filled" data-i18n="btn.start">‚ñ∂ Start</button>
            <button id="btnPause" class="btn tonal" data-i18n="btn.pause">‚è∏ Pause</button>
            <button id="btnReset" class="btn outlined" data-i18n="btn.reset">‚Ü∫ Reset</button>
            <button id="btnProfile" class="btn outlined" data-i18n="btn.profile" data-i18n-title="btn.profileTitle" title="Profile & achievements">üë§ Profile</button>
          </div>

          <div class="row" style="margin-top:10px; align-items:center;">
            <span class="pill" id="modePill"><span data-i18n="mode.label">Mode:</span> <b data-i18n="mode.select">Select</b></span>
            <div class="row segmented" role="group" aria-label="Mode" style="margin-left:auto;">
              <button id="btnSelect" class="btn text is-selected" data-i18n="mode.select">Select</button>
              <button id="btnLink" class="btn text" data-i18n="mode.link">Link</button>
              <button id="btnUnlink" class="btn text" data-i18n="mode.unlink">Unlink</button>
            </div>
          </div>

          <div class="tabBar" role="tablist" aria-label="Sections">
            <button class="tabBtn is-selected" id="tabBtnOverview" role="tab" aria-selected="true" aria-controls="tabOverview" data-tab="overview" data-i18n="nav.overview">Overview</button>
            <button class="tabBtn" id="tabBtnBacklog" role="tab" aria-selected="false" aria-controls="tabBacklog" data-tab="backlog" data-i18n="nav.backlog">Backlog</button>
            <button class="tabBtn" id="tabBtnSignals" role="tab" aria-selected="false" aria-controls="tabSignals" data-tab="signals" data-i18n="nav.signals">Signals</button>
            <button class="tabBtn" id="tabBtnHistory" role="tab" aria-selected="false" aria-controls="tabHistory" data-tab="history" data-i18n="nav.history">History</button>
          </div>
        </div>

        <div id="sideBody" class="sideBody">

        <section id="tabOverview" class="tabPanel" role="tabpanel" aria-labelledby="tabBtnOverview">

        <!-- Keep "Selected" high in the panel for fast diagnosis/repair cycles -->
        <section class="card" id="selCard">
          <div class="k" data-i18n="sel.title">Selected</div>
          <div class="v mono" id="selName" data-i18n="sel.none">None</div>
          <pre class="small mono" id="selStats">-</pre>
          <div class="row" style="margin-top:10px;">
            <button id="btnUpgrade" class="btn filled" disabled data-i18n="btn.upgrade">Upgrade</button>
            <button id="btnRepair" class="btn outlined" disabled data-i18n="btn.repair">Repair</button>
            <button id="btnDelete" class="btn error" disabled data-i18n="btn.delete">Delete</button>
          </div>
          <div class="small" style="margin-top:8px;" data-i18n="sel.hint">Upgrades raise capacity & reliability. Repairs restore health. Both cost budget</div>
        </section>

        <!-- High-signal observability block -->
        <section class="metricsGrid" aria-label="Key metrics">
          <div class="card">
            <div class="k" data-i18n="lbl.budget">Budget</div>
            <div class="v mono" id="budget">$500</div>
            <div class="small" data-i18n="hint.budget">Run ends at $0 or rating 1.0‚òÖ</div>
          </div>
          <div class="card">
            <div class="k" data-i18n="lbl.time">Time</div>
            <div class="v mono" id="time">0s</div>
            <div class="small" data-i18n="hint.time">Sim time</div>
          </div>
          <div class="card">
            <div class="k" data-i18n="lbl.shift">Shift</div>
            <div class="v mono" id="shift">0:00 / 9:00</div>
            <div class="small" data-i18n="hint.shift">Target session length</div>
          </div>
          <div class="card">
            <div class="k" data-i18n="lbl.rating">Rating</div>
            <div class="v mono" id="rating">5.0 ‚òÖ</div>
            <div class="small" data-i18n="hint.rating">Drops from failures / ANRs / slow</div>
          </div>
          <div class="card">
            <div class="k" data-i18n="lbl.score">Score</div>
            <div class="v mono" id="score">0</div>
            <div class="small" data-i18n="hint.score">Deterministic per seed</div>
          </div>
          <div class="card">
            <div class="k" data-i18n="lbl.arch">Architecture</div>
            <div class="v mono" id="archDebt">0</div>
            <div class="small" data-i18n="hint.arch">Debt (0..100)</div>
          </div>
          <div class="card">
            <div class="k" data-i18n="lbl.failures">Failures</div>
            <div class="v mono" id="fail">0.0%</div>
            <div class="small" data-i18n="hint.failures">Too many = review bombs</div>
          </div>
          <div class="card">
            <div class="k" data-i18n="lbl.coverage">Coverage</div>
            <div class="v mono" id="coverage">78%</div>
            <div class="small" id="coverageHint">Target 70%+</div>
          </div>
          <div class="card">
            <div class="k" data-i18n="lbl.anr">ANR Risk</div>
            <div class="v mono" id="anr">0.0%</div>
            <div class="small" data-i18n="hint.anr">Main thread pain</div>
          </div>
          <div class="card">
            <div class="k" data-i18n="lbl.latency">p95 Latency</div>
            <div class="v mono" id="lat">0 ms</div>
            <div class="small" data-i18n="hint.latency">Queueing makes it worse</div>
          </div>
          <div class="card">
            <div class="k" data-i18n="lbl.battery">Battery</div>
            <div class="v mono" id="bat">100</div>
            <div class="small" data-i18n="hint.battery">Work spam drains</div>
          </div>

          <div class="card">
            <div class="k" data-i18n="lbl.jank">Jank</div>
            <div class="v mono" id="jank">0%</div>
            <div class="small" data-i18n="hint.jank">FrameGuard 16ms</div>
          </div>
          <div class="card">
            <div class="k" data-i18n="lbl.heap">Heap</div>
            <div class="v mono" id="heap">64 MB</div>
            <div class="small"><span data-i18n="heapwatch.gc">HeapWatch GC</span> <span class="mono" id="gc">0</span> <span data-i18n="heapwatch.msOom">ms ‚Ä¢ OOM</span> <span class="mono" id="oom">0</span></div>
          </div>
        </section>

        <!-- Seed controls (required by src/main.ts). Kept lightweight so runs can be shared/replayed. -->
        <section class="card">
          <div class="k" data-i18n="card.seed">Seed</div>
          <div class="small" style="margin-top:8px;">
            <span data-i18n="seed.active">Active:</span> <span id="seedVal" class="mono">0</span>
          </div>
          <div class="row" style="margin-top:8px; gap:8px;">
            <input id="seedInput" class="input" style="flex:1;" type="number" step="1" data-i18n-placeholder="seed.placeholder" placeholder="Seed (optional)" />
            <button id="btnDailySeed" class="btn text" title="Use a deterministic daily seed" data-i18n="seed.daily" data-i18n-title="seed.dailyTitle">Daily</button>
          </div>
          <div class="small muted" style="margin-top:8px;" data-i18n="seed.note">Reset uses the seed above (if set).</div>
        </section>

        <section class="card">
          <div class="k" data-i18n="card.achievements">Achievements</div>
          <div class="small" style="margin-top:8px;">
            <span data-i18n="ach.preset">Preset:</span> <span id="achPreset" class="mono">SENIOR</span> ‚Ä¢
            <span data-i18n="ach.unlocked">Unlocked:</span> <span id="achUnlocked" class="mono">0</span>/<span id="achTotal" class="mono">0</span>
          </div>
          <div class="row" style="margin-top:10px;">
            <button id="btnOpenProfile" class="btn tonal" data-i18n="ach.openProfile">Open profile</button>
</div>
        </section>


        <section class="card">
          <div class="k" data-i18n="card.trust">Trust &amp; accessibility</div>
          <div class="small" style="margin-top:8px;">
            <span data-i18n="trust.a11y">A11y</span>: <span class="mono" id="a11yScore">100</span>/100 ‚Ä¢
            <span data-i18n="trust.privacy">Privacy</span>: <span class="mono" id="privacyTrust">100</span>/100 ‚Ä¢
            <span data-i18n="trust.security">Security</span>: <span class="mono" id="securityPosture">100</span>/100 ‚Ä¢
            <span data-i18n="trust.supportLoad">Support load</span>: <span class="mono" id="supportLoad">0</span>/100
          </div>
        </section>

        <!-- Setup & controls: kept in overview because it's a primary interaction surface -->
        <div class="sideGroup">
          <section class="card">
            <div class="k" data-i18n="setup.evalPreset">Evaluation preset</div>
            <div class="row" style="margin-top:8px;">
              <select id="presetSelect">
                <option value="JUNIOR_MID" data-i18n="preset.juniorMid">Junior-Mid</option>
                <option value="SENIOR" data-i18n="preset.senior">Senior</option>
                <option value="STAFF" data-i18n="preset.staff">Staff</option>
                <option value="PRINCIPAL" data-i18n="preset.principal">Principal</option>
              </select>
            </div>
            <div class="small muted" style="margin-top:8px;" data-i18n="setup.evalPresetHint">CoverageGate and enforcement weight</div>
          </section>

          <section class="card">
            <div class="k" data-i18n="setup.placeComponent">Place component</div>
            <div class="row" style="margin-top:8px;">
              <select id="componentType">
                <option value="UI" data-i18n="component.UI">UI</option>
                <option value="VM" data-i18n="component.VM">ViewModel</option>
                <option value="DOMAIN" data-i18n="component.DOMAIN">Domain</option>
                <option value="REPO" data-i18n="component.REPO">Repository</option>
                <option value="CACHE" data-i18n="component.CACHE">Cache</option>
                <option value="DB" data-i18n="component.DB">Room DB</option>
                <option value="NET" data-i18n="component.NET">Network</option>
                <option value="WORK" data-i18n="component.WORK">WorkManager</option>
                <option value="OBS" data-i18n="component.OBS">Observability</option>
                <option value="FLAGS" data-i18n="component.FLAGS">Feature Flags</option>
                <option value="AUTH" data-i18n="component.AUTH">Auth / Sessions</option>
                <option value="PINNING" data-i18n="component.PINNING">TLS Pinning</option>
                <option value="KEYSTORE" data-i18n="component.KEYSTORE">Keystore / Crypto</option>
                <option value="SANITIZER" data-i18n="component.SANITIZER">Input Sanitizer</option>
                <option value="ABUSE" data-i18n="component.ABUSE">Abuse Protection</option>
                <option value="A11Y" data-i18n="component.A11Y">Accessibility Layer</option>
              </select>
              <button id="btnAdd" class="btn tonal" data-i18n="btn.add">+ Add</button>
            </div>
            <div class="small" style="margin-top:8px;">
              <span data-i18n="setup.dragHintPrefix">Drag components to rearrange. Link mode: click</span> <span class="mono" data-i18n="setup.dragHintSource">source</span> ‚Üí <span data-i18n="setup.dragHintThen">click</span> <span class="mono" data-i18n="setup.dragHintDest">destination</span>
            </div>
          </section>
        </div>

        </section> <!-- /tabOverview -->

        <section id="tabBacklog" class="tabPanel" role="tabpanel" aria-labelledby="tabBtnBacklog">
        <section class="card" id="backlogCard">
          <div class="k" data-i18n="nav.backlog">Backlog</div>
          <div class="row capRow" style="margin-top:8px; align-items:center;">
            <div class="pill"><span data-i18n="backlog.capacity">Capacity</span> <span id="capVal" class="mono">0/0</span> <span id="capRegenHint" class="small muted mono">+0/min</span></div>

            <div class="capBtns" style="margin-left:auto;">
              <button id="btnCapRefill" class="btn text" data-i18n="btn.refill">Refill</button>
              <button id="btnCapBoost" class="btn text" data-i18n="btn.boostRegen">Boost regen</button>
              <button id="btnCapDrink" class="btn text" hidden title="Temporary regen booster (unlocks via achievements)" data-i18n="btn.energyDrink" data-i18n-title="btn.energyDrinkTitle">Energy drink</button>
              <button id="btnCapShield" class="btn text" hidden title="Blocks the next incident penalty once (unlocks via achievements)" data-i18n="btn.incidentShield" data-i18n-title="btn.incidentShieldTitle">Incident shield</button>
              <button id="btnCapHire" class="btn text" data-i18n="btn.hire">Hire</button>
            </div>

            <div class="small muted capRight" data-i18n="backlog.fixOrDefer">Fix tickets or defer</div>
          </div>
          <div id="ticketList" class="ticketList" style="margin-top:10px;"></div>
        </section>



        
        <section class="card">
          <div class="row" style="align-items:center;">
            <div class="k" data-i18n="card.roadmap">Refactor Roadmap</div>
            <div style="margin-left:auto;">
              <button id="btnApplyNextRoadmap" class="btn text" data-i18n="btn.applyNext">Apply next</button>
            </div>
          </div>
          <div class="small muted" style="margin-top:6px;" data-i18n="history.roadmapHint">Suggested sequence to pay down architecture debt (Staff/Principal-style).</div>
          <pre class="small" id="roadmap" style="margin-top:8px;" data-i18n="history.noRoadmap">No roadmap yet.</pre>
        </section>


        

        

        </section> <!-- /tabBacklog -->

        <section id="tabSignals" class="tabPanel" role="tabpanel" aria-labelledby="tabBtnSignals">

        <div class="sideGroup">
          <section class="card">
            <div class="k" data-i18n="card.platform">Platform</div>
            <div class="small" style="margin-top:8px;">
              <span data-i18n="platform.latestApi">Latest API</span> <span id="apiLatest" class="mono">0</span> ‚Ä¢ <span data-i18n="platform.minApi">Min API</span> <span id="apiMin" class="mono">0</span>
            </div>
            <div class="small muted" style="margin-top:4px;">
              <span data-i18n="platform.oldDevices">Old devices</span> <span id="oldShare" class="mono">0</span>% ‚Ä¢ <span data-i18n="platform.lowRam">Low RAM</span> <span id="lowRamShare" class="mono">0</span>%
            </div>
            <div id="advisoryText" class="small" style="margin-top:8px;"></div>
          </section>

          <section class="card">
            <div class="k" data-i18n="card.regions">Regions</div>
            <div class="row" style="margin-top:8px; align-items:center;">
              <div class="pill"><span data-i18n="regions.regPressure">Reg pressure</span> <span id="regPressure" class="mono">0</span></div>
              <div class="small muted" style="margin-left:auto;" data-i18n="regions.hint">Compliance and rollout gates</div>
            </div>
            <div id="regionList" class="regionList" style="margin-top:10px;"></div>
          </section>
        </div>

        <section class="card">
          <div class="k" data-i18n="card.votes">User votes (live sentiment)</div>
          <div class="small" style="margin-top:8px;">
            <span data-i18n="votes.perf">Perf</span>: <span class="mono" id="votesPerf">0</span> ‚Ä¢
            <span data-i18n="votes.reliability">Reliability</span>: <span class="mono" id="votesReliability">0</span> ‚Ä¢
            <span data-i18n="votes.privacy">Privacy</span>: <span class="mono" id="votesPrivacy">0</span> ‚Ä¢
            <span data-i18n="votes.a11y">A11y</span>: <span class="mono" id="votesA11y">0</span> ‚Ä¢
            <span data-i18n="votes.battery">Battery</span>: <span class="mono" id="votesBattery">0</span>
          </div>
          <pre class="small" id="reviewLog" style="margin-top:8px;" data-i18n="signals.noReviews">No reviews yet.</pre>
        </section>

        <section class="card" id="incidentsCard">
          <div class="k" data-i18n="card.incidents">Incidents</div>
          <pre class="small" id="eventLog" data-i18n="signals.noIncidents">No incidents‚Ä¶ yet.</pre>
        </section>

        </section> <!-- /tabSignals -->

        <section id="tabHistory" class="tabPanel" role="tabpanel" aria-labelledby="tabBtnHistory">
        <section class="card">
          <div class="row" style="align-items:center;">
            <div class="k" data-i18n="card.postmortem">Postmortem</div>
            <div style="margin-left:auto;">
              <button id="btnCopyRun" class="btn text" data-i18n="btn.copyRunJson">Copy run JSON</button>
            </div>
          </div>
          <pre class="small" id="postmortem" data-i18n="history.noRun">No run yet.</pre>
        </section>

        <section class="card">
          <div class="row" style="align-items:center;">
            <div class="k" data-i18n="card.scoreboard">Scoreboard (local)</div>
            <div style="margin-left:auto;">
              <button id="btnClearScoreboard" class="btn text" data-i18n="btn.clear">Clear</button>
            </div>
          </div>
          <div class="small muted" style="margin-top:6px;" data-i18n="history.scoreboardHint">Top runs stored in localStorage.</div>
          <pre class="small" id="scoreboardList" style="margin-top:8px;" data-i18n="history.noScores">No scores yet.</pre>
        </section>

<section class="card">
          <div class="k" data-i18n="history.realismTitle">Android realism features (implemented)</div>
          <ol class="small" style="margin:8px 0 0; padding-left:18px;">
            <li><b>FrameGuard</b> <span data-i18n="history.realism.frameguard">frame budget and jank meter (16ms model)</span></li>
            <li><b>MainThreadGuard</b> <span data-i18n="history.realism.mainthread">IO on main strictness (adds ANR and jank)</span></li>
            <li><b>HeapWatch</b> <span data-i18n="history.realism.heapwatch">heap meter with GC pauses and OOM crashes</span></li>
          </ol>
        </section>

        <p class="small">
          <span data-i18n="history.recoPrefix">Recommended starter graph:</span> <span class="mono">UI ‚Üí VM ‚Üí Domain ‚Üí Repo ‚Üí (Cache ‚Üí DB)</span> <span data-i18n="history.recoAnd">and</span> <span class="mono">Repo ‚Üí Net</span>.
          <span data-i18n="history.recoAdd">Add</span> <span class="mono">Observability</span> + <span class="mono">Feature Flags</span> <span data-i18n="history.recoSuffix">to reduce blast radius</span>
        </p>

        <div id="buildInfo" class="small mono" style="opacity:.75; margin-top:10px;"></div>

        </section> <!-- /tabHistory -->

        </div> <!-- /sideBody -->

      </aside>
    </div>

    <!-- Incident response: shown briefly when a new incident hits -->
    <div id="incidentOverlay" class="incidentOverlay" hidden aria-live="polite" aria-atomic="true">
      <div class="card incidentOverlayInner">
        <div class="row" style="align-items:center;">
          <div class="pill" style="border-color: color-mix(in oklab, var(--md-sys-color-error) 70%, transparent);" data-i18n="incident.label">Incident</div>
          <div id="incidentOverlayTitle" class="small mono" style="margin-left:10px; flex:1; min-width:0; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;">-</div>
          <button id="incidentOverlayDismiss" class="btn text" aria-label="Dismiss incident" data-i18n-aria-label="incident.dismiss">‚úï</button>
        </div>
        <div id="incidentOverlayHint" class="small muted" style="margin-top:8px;" data-i18n="incident.hint">Respond fast: fix or defer the top ticket to stop the bleed.</div>
        <div class="row" style="margin-top:10px; justify-content:flex-end; flex-wrap:wrap;">
          <button id="incidentOverlayBacklog" class="btn outlined" data-i18n="btn.openBacklog">Open backlog</button>
          <button id="incidentOverlayRefill" class="btn outlined" data-i18n="btn.refill">Refill</button>
          <button id="incidentOverlayTriage" class="btn filled" data-i18n="btn.quickTriage">Quick triage</button>
        </div>
      </div>
    </div>

    <!-- Profile + achievements (per preset) -->
    <div id="profileModal" class="modal" hidden role="dialog" aria-modal="true" aria-labelledby="profileTitle">
      <div class="modalBackdrop" id="profileBackdrop"></div>
      <div class="modalPanel card">
        <div class="row" style="align-items:center; gap:10px;">
          <h2 id="profileTitle" style="margin:0; font-size:16px;" data-i18n="profile.title">Profile</h2>
          <div class="pill" style="margin-left:auto;" data-i18n="profile.preset">Preset</div>
          <select id="profilePresetSelect">
            <option value="JUNIOR_MID" data-i18n="preset.juniorMid">Junior-Mid</option>
            <option value="SENIOR" data-i18n="preset.senior">Senior</option>
            <option value="STAFF" data-i18n="preset.staff">Staff</option>
            <option value="PRINCIPAL" data-i18n="preset.principal">Principal</option>
          </select>
          <button id="btnCloseProfile" class="btn text" aria-label="Close profile" data-i18n-aria-label="profile.close">‚úï</button>
        </div>

        <div class="small" style="margin-top:10px;">
          <span data-i18n="profile.unlocked">Unlocked:</span> <span id="profileUnlocked" class="mono">0</span>/<span id="profileTotal" class="mono">0</span>
          ‚Ä¢ <span data-i18n="profile.best">Best survival:</span> <span id="profileBest" class="mono">0s</span>
        </div>

        <div id="profileAchList" class="achList" style="margin-top:12px;"></div>

        <div class="small muted" style="margin-top:12px;" data-i18n="profile.hiddenNote">
          Hidden achievements show up as ‚ÄúHidden achievement‚Äù until you unlock them.
        </div>

        <hr class="sep" />

        <div class="k" data-i18n="settings.title">Settings</div>
        <div class="row" style="margin-top:10px; align-items:center; gap:10px; flex-wrap:wrap;">
          <div class="pill" data-i18n="settings.language">Language</div>
          <select id="langSelect" style="margin-left:auto; min-width:180px;">
            <!-- options populated by src/i18n.ts (production locale list) -->
          </select>
        </div>

        <div class="row" style="margin-top:10px; align-items:center; gap:10px; flex-wrap:wrap;">
          <div class="pill" data-i18n="settings.theme">Theme</div>
          <select id="themeSelect" style="margin-left:auto; min-width:180px;">
            <option value="system" data-i18n="theme.system">System</option>
            <option value="light" data-i18n="theme.light">Light</option>
            <option value="dark" data-i18n="theme.dark">Dark</option>
          </select>
        </div>

        <!-- Glass mode removed: low-transparency UI read as "disabled" and caused confusion. -->
      </div>
    </div>

    <!-- Refactor options (architecture debt) -->
    <div id="refactorModal" class="modal" hidden role="dialog" aria-modal="true" aria-labelledby="refactorTitle">
      <div class="modalBackdrop" id="refactorBackdrop"></div>
      <div class="modalPanel card">
        <div class="row" style="align-items:center; gap:10px;">
          <h2 id="refactorTitle" style="margin:0; font-size:16px;" data-i18n="ticket.refactorOptions">Refactor options</h2>
          <button id="btnCloseRefactor" class="btn text" aria-label="Close refactor options" data-i18n-aria-label="ticket.closeRefactor" style="margin-left:auto;">‚úï</button>
        </div>

        <div id="refactorTicketTitle" class="small" style="margin-top:10px;"></div>

        <div class="row" style="margin-top:12px; align-items:center; gap:10px; flex-wrap:wrap;">
          <div class="pill" data-i18n="ticket.target">Target</div>
          <select id="refactorTargetSelect" class="input mono" style="margin-left:auto; min-width:220px;"></select>
        </div>

        <div id="refactorOptions" class="refactorList" style="margin-top:12px;"></div>

        <div class="small muted" style="margin-top:12px;" data-i18n="ticket.refactorHint">
          Refactors spend budget and reduce architecture debt. Pick the cheapest thing that fixes the worst violation.
        </div>
      </div>
    </div>

    <script type="module" src="/src/main.ts"></script>
  </body>
</html>