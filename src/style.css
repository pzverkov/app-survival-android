:root {
  /* Material 3-ish design tokens (dark). Not official M3 CSS - this is a faithful vibe. */
  color-scheme: light dark;

  /* Typography */
  --md-sys-typescale-title-medium-size: 16px;
  --md-sys-typescale-title-medium-line: 24px;
  --md-sys-typescale-body-small-size: 12px;
  --md-sys-typescale-body-small-line: 18px;
  --md-sys-typescale-label-small-size: 11px;
  --md-sys-typescale-label-small-line: 16px;

  /* Shape */
  --md-sys-shape-corner-extra-small: 8px;
  --md-sys-shape-corner-small: 12px;
  --md-sys-shape-corner-medium: 16px;
  --md-sys-shape-corner-large: 20px;

  /* Core colors (tuned for “Android enterprise tooling” feel) */
  --md-sys-color-primary: #8ab4f8;
  --md-sys-color-on-primary: #061021;
  --md-sys-color-primary-container: #1a2a44;
  --md-sys-color-on-primary-container: #d7e3ff;

  --md-sys-color-secondary: #c2c6dc;
  --md-sys-color-on-secondary: #1b1e2a;
  --md-sys-color-secondary-container: #2a2f40;
  --md-sys-color-on-secondary-container: #e2e5f7;

  --md-sys-color-tertiary-container: #26324a;
  --md-sys-color-on-tertiary-container: #dbe7ff;

  --md-sys-color-error: #ffb4ab;
  --md-sys-color-on-error: #310001;
  --md-sys-color-error-container: #601410;
  --md-sys-color-on-error-container: #ffdad6;

  --md-sys-color-background: #0b0e14;
  --md-sys-color-on-background: rgba(255,255,255,0.92);

  --md-sys-color-surface: #0f131c;
  --md-sys-color-on-surface: rgba(255,255,255,0.92);
  --md-sys-color-surface-variant: #1a1f2b;
  --md-sys-color-on-surface-variant: rgba(255,255,255,0.74);

  --md-sys-color-outline: var(--app-border-strong);
  --md-sys-color-outline-variant: var(--app-border);

  /* Surface containers (M3 concept)
     NOTE: keep these opaque-ish. Ultra-transparent surfaces read as "disabled". */
  --card: rgba(17, 24, 39, 0.88);
  --card-low: rgba(17, 24, 39, 0.76);
  --card-high: rgba(17, 24, 39, 0.94);
  --code-bg: rgba(10, 14, 22, 0.92);

  --md-sys-color-surface-container-low: var(--card-low);
  --md-sys-color-surface-container: var(--card);
  --md-sys-color-surface-container-high: var(--card-high);
  --md-sys-color-surface-container-highest: color-mix(in oklab, var(--card-high) 92%, white 8%);

  /* App neutrals (borders, muted text) */
  --app-ink-muted: rgba(255,255,255,0.74);
  --app-ink-muted-2: rgba(255,255,255,0.62);
  --app-border: rgba(255,255,255,0.14);
  --app-border-strong: rgba(255,255,255,0.20);
  /* State layers */
  --md-state-hover: rgba(255,255,255,0.06);
  --md-state-press: var(--app-border);
  --md-state-focus: rgba(138,180,248,0.30);

  /* Elevation */
  --md-elevation-1: 0 1px 2px rgba(0,0,0,0.55), 0 1px 3px rgba(0,0,0,0.30);
  --md-elevation-2: 0 2px 6px rgba(0,0,0,0.55), 0 6px 18px rgba(0,0,0,0.30);
  --md-elevation-3: 0 8px 28px rgba(0,0,0,0.55);

  /* Spacing */
  --md-pad-1: 8px;
  --md-pad-2: 12px;
  --md-pad-3: 16px;
  --md-pad-4: 20px;
}

html, body {
  height: 100%;
  background: var(--md-sys-color-background);
}

/* Canvas background tokens (so theme switching is obvious) */
:root {
  --canvas-bg-1: #18223a;
  --canvas-bg-2: #070a10;
}

/* Theme: Light palette (system preference) */
@media (prefers-color-scheme: light) {
  :root {
    --md-sys-color-primary: #6750A4;
    --md-sys-color-on-primary: #FFFFFF;
    --md-sys-color-primary-container: #EADDFF;
    --md-sys-color-on-primary-container: #21005D;

    --md-sys-color-secondary: #625B71;
    --md-sys-color-on-secondary: #FFFFFF;
    --md-sys-color-secondary-container: #E8DEF8;
    --md-sys-color-on-secondary-container: #1D192B;

    --md-sys-color-tertiary-container: #FFD8E4;
    --md-sys-color-on-tertiary-container: #31111D;

    --md-sys-color-error: #B3261E;
    --md-sys-color-on-error: #FFFFFF;
    --md-sys-color-error-container: #F9DEDC;
    --md-sys-color-on-error-container: #410E0B;

    --md-sys-color-background: #FFFBFE;
    --md-sys-color-on-background: rgba(0,0,0,0.88);

    --md-sys-color-surface: #FFFBFE;
    --md-sys-color-on-surface: rgba(0,0,0,0.88);
    --md-sys-color-surface-variant: #E7E0EC;
    --md-sys-color-on-surface-variant: rgba(0,0,0,0.70);

    --md-sys-color-outline: rgba(0,0,0,0.20);
    --md-sys-color-outline-variant: rgba(0,0,0,0.12);

    --md-sys-color-surface-container-low: #F7F2FA;
    --md-sys-color-surface-container: #F3EDF7;
    --md-sys-color-surface-container-high: #ECE6F0;
    --md-sys-color-surface-container-highest: #E6E0E9;

    --code-bg: #EEE7F3;

    --app-ink-muted: rgba(0,0,0,0.68);
    --app-ink-muted-2: rgba(0,0,0,0.54);
    --app-border: rgba(0,0,0,0.12);
    --app-border-strong: rgba(0,0,0,0.16);
    --canvas-bg-1: #e9e2f5;
    --canvas-bg-2: #faf7ff;
  }
}

/* Theme: Forced modes via html[data-theme] */
html[data-theme="dark"] {
  color-scheme: dark;
}

html[data-theme="light"] {
  color-scheme: light;

  --md-sys-color-primary: #6750A4;
  --md-sys-color-on-primary: #FFFFFF;
  --md-sys-color-primary-container: #EADDFF;
  --md-sys-color-on-primary-container: #21005D;

  --md-sys-color-secondary: #625B71;
  --md-sys-color-on-secondary: #FFFFFF;
  --md-sys-color-secondary-container: #E8DEF8;
  --md-sys-color-on-secondary-container: #1D192B;

  --md-sys-color-tertiary-container: #FFD8E4;
  --md-sys-color-on-tertiary-container: #31111D;

  --md-sys-color-error: #B3261E;
  --md-sys-color-on-error: #FFFFFF;
  --md-sys-color-error-container: #F9DEDC;
  --md-sys-color-on-error-container: #410E0B;

  --md-sys-color-background: #FFFBFE;
  --md-sys-color-on-background: rgba(0,0,0,0.88);

  --md-sys-color-surface: #FFFBFE;
  --md-sys-color-on-surface: rgba(0,0,0,0.88);
  --md-sys-color-surface-variant: #E7E0EC;
  --md-sys-color-on-surface-variant: rgba(0,0,0,0.70);

  --md-sys-color-outline: rgba(0,0,0,0.20);
  --md-sys-color-outline-variant: rgba(0,0,0,0.12);

  --md-sys-color-surface-container-low: #F7F2FA;
  --md-sys-color-surface-container: #F3EDF7;
  --md-sys-color-surface-container-high: #ECE6F0;
  --md-sys-color-surface-container-highest: #E6E0E9;

  --code-bg: #EEE7F3;

  --app-ink-muted: rgba(0,0,0,0.68);
  --app-ink-muted-2: rgba(0,0,0,0.54);
  --app-border: rgba(0,0,0,0.12);
  --app-border-strong: rgba(0,0,0,0.16);
  --canvas-bg-1: #e9e2f5;
  --canvas-bg-2: #faf7ff;
}

body {
  margin: 0;
  color: var(--md-sys-color-on-background);
  font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI Variable", "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Noto Sans CJK SC", "Noto Sans CJK JP", "Noto Sans Devanagari", "PingFang SC", "Hiragino Sans", "Hiragino Kaku Gothic ProN", "Yu Gothic", Meiryo, "Microsoft YaHei", "Microsoft JhengHei", "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}


button, input, select, textarea {
  font: inherit;
  color: inherit;
}

/* Layout */
.wrap {
  display: grid;
  /* Canvas + control surface. Side panel uses clamp so it can breathe on laptops
     and become a real dashboard on wide monitors without crushing the canvas. */
  /* Cap the dashboard width on ultrawide monitors so the canvas doesn't get starved. */
  grid-template-columns: minmax(420px, 1fr) minmax(360px, clamp(380px, 30vw, 600px));
  height: 100vh;
}

/* Wide laptops/desktops: give the dashboard a bit more breathing room to reduce vertical scroll. */
@media (min-width: 1100px) and (min-height: 700px) {
  .wrap {
    grid-template-columns: minmax(420px, 1fr) minmax(380px, clamp(420px, 32vw, 640px));
  }
}


/* Small screens: stack canvas above the dashboard (single scroll surface). */
@media (max-width: 900px) {
  .wrap {
    grid-template-columns: 1fr;
    grid-template-rows: minmax(320px, 1fr) minmax(280px, 46vh);
    height: 100dvh;
  }
  .side { border-left: none; border-top: 1px solid var(--md-sys-color-outline-variant); }
}

.canvasWrap {
  position: relative;
  min-width: 0;
  min-height: 0;
}

.canvasHud {
  position: absolute;
  top: 10px;
  right: 10px;
  display: flex;
  gap: 8px;
  z-index: 2;
}

.btn.hud {
  padding: 6px 10px;
  min-width: 34px;
  height: 34px;
  border-radius: 12px;
  background: var(--md-sys-color-surface-container-high);
  border: 1px solid var(--md-sys-color-outline-variant);
  box-shadow: var(--md-elevation-1);
}

.btn.hud:hover { background: var(--md-sys-color-surface-container-highest); }

canvas {
  display: block;
  width: 100%;
  height: 100%;
  cursor: crosshair;
  background:
    radial-gradient(1200px 700px at 30% 20%, var(--canvas-bg-1), var(--canvas-bg-2));
}

/* Right panel (like a persistent “details” sheet) */
.side {
  border-left: 1px solid var(--md-sys-color-outline-variant);
  padding: var(--md-pad-3) var(--md-pad-3) var(--md-pad-4);
  overflow: hidden;
  display: flex;
  flex-direction: column;
  gap: 12px;
  background: var(--md-sys-color-surface);
}

.sideBody {
  overflow: auto;
  scroll-behavior: smooth;
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 12px;
  padding-top: 12px;
}

.sideHeader {
  position: sticky;
  top: 0;
  z-index: 5;
  padding-bottom: 10px;
  background: var(--md-sys-color-surface-container-high);
  border: 1px solid var(--md-sys-color-outline-variant);
  border-radius: var(--md-sys-shape-corner-large);
  box-shadow: var(--md-elevation-1);
}

.tabBar {
  display: flex;
  gap: 6px;
  padding: 10px 12px 12px;
  border-top: 1px solid var(--md-sys-color-outline-variant);
  margin-top: 10px;
  overflow-x: auto;
  overscroll-behavior-x: contain;
  -webkit-overflow-scrolling: touch;
}

.tabBar::-webkit-scrollbar { height: 8px; }
.tabBar::-webkit-scrollbar-thumb {
  background: color-mix(in oklab, var(--md-sys-color-outline) 40%, transparent);
  border-radius: 999px;
}


.tabBtn {
  appearance: none;
  flex: 0 0 auto;
  min-width: 88px;
  border: 1px solid var(--md-sys-color-outline-variant);
  background: transparent;
  color: var(--md-sys-color-on-surface-variant);
  border-radius: 14px;
  padding: 8px 10px;
  font-size: 12px;
  cursor: pointer;
  transition: transform 120ms ease, background 140ms ease, border-color 140ms ease;
}

.tabBtn:hover { background: var(--md-state-hover); }

.tabBtn.is-selected {
  background: color-mix(in oklab, var(--md-sys-color-primary-container) 60%, transparent);
  border-color: color-mix(in oklab, var(--md-sys-color-primary) 60%, var(--md-sys-color-outline-variant));
  color: var(--md-sys-color-on-primary-container);
}

.tabPanel { display: flex; flex-direction: column; gap: 12px; }

/* Mobile polish: tabs remain usable even when the panel is narrow. */
@media (max-width: 900px) {
  .tabBar { padding-bottom: 10px; }
  .canvasHud { top: 8px; right: 8px; }
}

.sideHeader > * {
  padding: 0 12px;
}

.sideHeader h1 {
  padding-top: 10px;
}

.sideHeader .row:last-child {
  padding-bottom: 10px;
}

.side::before {
  content: "";
  position: sticky;
  top: 0;
  display: block;
  height: 0;
  box-shadow:
    0 -1px 0 var(--md-sys-color-outline-variant),
    0 14px 70px rgba(138,180,248,0.10);
}

/* Typography */
h1 {
  margin: 0 0 12px;
  font-size: var(--md-sys-typescale-title-medium-size);
  line-height: var(--md-sys-typescale-title-medium-line);
  letter-spacing: 0.2px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.k {
  font-size: var(--md-sys-typescale-label-small-size);
  line-height: var(--md-sys-typescale-label-small-line);
  color: var(--md-sys-color-on-surface-variant);
}

.v {
  font-size: 14px;
}

.small {
  font-size: var(--md-sys-typescale-body-small-size);
  line-height: var(--md-sys-typescale-body-small-line);
  color: var(--md-sys-color-on-surface-variant);
}

.mono {
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New";
}

/* Structure */
.row {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

/* Backlog capacity controls */
.capRow { align-items: center; }
.capRow .capBtns { display:flex; gap:6px; flex-wrap:wrap; margin-left:auto; }
.capRow .capRight { margin-left:auto; white-space:nowrap; }

@media (max-width: 540px) {
  .capRow .capBtns { margin-left:0; width:100%; }
  .capRow .capRight { margin-left:0; width:100%; white-space:normal; }
}

/* High-signal metrics block: adapts from 2 cols to 3/4 based on available width */
.metricsGrid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 10px;
}

/* Generic grouping that becomes 2 columns when there is enough width */
.sideGroup {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 12px;
}

.sideFooter {
  border-top: 1px solid var(--md-sys-color-outline-variant);
  padding-top: 12px;
}

.hr {
  height: 1px;
  background: var(--md-sys-color-outline-variant);
  margin: 12px 0;
}

/* Surfaces (cards) */
.card {
  background: var(--md-sys-color-surface-container);
  border: 1px solid var(--md-sys-color-outline-variant);
  border-radius: var(--md-sys-shape-corner-large);
  padding: 12px;
  box-shadow: var(--md-elevation-1);
}

/* Badges / chips */
.badge,
.pill {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  border-radius: 999px;
  padding: 6px 10px;
  border: 1px solid var(--md-sys-color-outline-variant);
  background: var(--md-sys-color-surface-container-low);
  color: var(--md-sys-color-on-surface-variant);
  font-size: var(--md-sys-typescale-label-small-size);
  line-height: var(--md-sys-typescale-label-small-line);
}

/* Inputs */
select {
  appearance: none;
  background: var(--md-sys-color-surface-container-high);
  color: var(--md-sys-color-on-surface);
  border: 1px solid var(--md-sys-color-outline-variant);
  padding: 10px 12px;
  border-radius: var(--md-sys-shape-corner-small);
  cursor: pointer;
  transition: border-color 120ms ease, background 120ms ease;
}

select:hover {
  border-color: var(--md-sys-color-outline);
  background: var(--md-sys-color-surface-container-highest);
}

/* Buttons (Material 3-ish variants) */
.btn {
  appearance: none;
  border: 1px solid transparent;
  border-radius: var(--md-sys-shape-corner-small);
  padding: 10px 12px;
  cursor: pointer;
  color: var(--md-sys-color-on-surface);
  background: transparent;
  transition: transform 120ms ease, filter 120ms ease, background 120ms ease, border-color 120ms ease;
}

.btn:active { transform: translateY(1px); }

.btn:disabled {
  opacity: 0.45;
  cursor: not-allowed;
}

.btn.filled {
  background: var(--md-sys-color-primary);
  color: var(--md-sys-color-on-primary);
  box-shadow: var(--md-elevation-1);
}

.btn.filled:hover { filter: brightness(1.05); }

.btn.tonal {
  background: var(--md-sys-color-secondary-container);
  color: var(--md-sys-color-on-secondary-container);
  box-shadow: var(--md-elevation-1);
}

.btn.tonal:hover { filter: brightness(1.04); }

.btn.outlined {
  border-color: var(--md-sys-color-outline);
  background: transparent;
}

.btn.outlined:hover {
  background: var(--md-state-hover);
}

.btn.text {
  border-color: transparent;
}

.btn.text:hover {
  background: var(--md-state-hover);
}

.btn.error {
  background: var(--md-sys-color-error-container);
  color: var(--md-sys-color-on-error-container);
  box-shadow: var(--md-elevation-1);
}

.btn.error:hover { filter: brightness(1.03); }

/* Segmented buttons (for Mode) */
.segmented {
  background: var(--md-sys-color-surface-container-low);
  border: 1px solid var(--md-sys-color-outline-variant);
  border-radius: 999px;
  padding: 4px;
}

.segmented .btn {
  border-radius: 999px;
  padding: 8px 12px;
}

.segmented .btn:hover { background: var(--md-state-hover); }

.segmented .btn.is-selected {
  background: var(--md-sys-color-tertiary-container);
  color: var(--md-sys-color-on-tertiary-container);
}

/* Focus ring (keyboard accessibility) */
.btn:focus-visible, select:focus-visible, a:focus-visible {
  outline: 2px solid rgba(138,180,248,0.75);
  outline-offset: 2px;
}

/* Logs / blocks */
pre {
  margin: 6px 0 0;
  white-space: pre-wrap;
  background: var(--code-bg);
  border: 1px solid var(--md-sys-color-outline-variant);
  border-radius: var(--md-sys-shape-corner-medium);
  padding: 10px;
}

ol { margin: 8px 0 0; }

/* Scrollbar polish */
.side {
  scrollbar-color: rgba(255,255,255,0.22) rgba(255,255,255,0.05);
  scrollbar-width: thin;
}

.side::-webkit-scrollbar { width: 10px; }

.side::-webkit-scrollbar-thumb {
  background: rgba(255,255,255,0.18);
  border-radius: 999px;
  border: 2px solid rgba(0,0,0,0.0);
  background-clip: padding-box;
}

.side::-webkit-scrollbar-track { background: rgba(255,255,255,0.04); }

/* Responsive: on narrow screens, side becomes a bottom sheet */
@media (max-width: 980px) {
  .wrap {
    grid-template-columns: 1fr;
    grid-template-rows: 1fr min(62vh, 540px);
  }

  .side {
    border-left: none;
    border-top: 1px solid var(--md-sys-color-outline-variant);
    box-shadow: var(--md-elevation-3);
    border-radius: 20px 20px 0 0;
  }
}

@media (prefers-reduced-motion: reduce) {
  .btn, select { transition: none; }
}

/* Dropdown options (improves dark mode menus on some browsers) */
select, option {
  color-scheme: light dark;
}
select option {
  background: var(--md-sys-color-surface-container-highest);
  color: var(--md-sys-color-on-surface);
}
select:focus-visible {
  outline: 2px solid var(--md-sys-color-primary);
  outline-offset: 2px;
}

/* Button state highlighting */
.btn.is-active {
  box-shadow: 0 0 0 2px var(--md-sys-color-primary) inset;
}
.btn.error.is-active {
  box-shadow: 0 0 0 2px var(--md-sys-color-error) inset;
}


/* TicketFlow UI */
.ticketList {
  display: grid;
  grid-template-columns: 1fr;
  gap: 10px;
}

@media (min-width: 720px) {
  /* When the side panel is wide enough, show tickets in 2 columns. */
  .ticketList { grid-template-columns: repeat(2, minmax(0, 1fr)); }
}

.ticket {
  display: flex;
  gap: 10px;
  padding: 10px;
  border-radius: 14px;
  background: var(--md-sys-color-surface-container);
  border: 1px solid rgba(255,255,255,0.06);
}

.ticketMain { flex: 1; min-width: 0; }

.ticketTitle {
  font-size: 13px;
  font-weight: 650;
  color: var(--md-sys-color-on-surface);
  overflow: hidden;
  text-overflow: ellipsis;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
}

/* User-triggered expansion for long non-arch ticket titles. */
.ticket.is-expanded .ticketTitle {
  overflow: visible;
  text-overflow: unset;
  display: block;
  -webkit-line-clamp: unset;
}

/* Architecture debt titles are long and information-dense; show them in full. */
.ticket.is-arch .ticketTitle {
  overflow: visible;
  text-overflow: unset;
  display: block;
  -webkit-line-clamp: unset;
}

.ticketTitleText {
  min-width: 0;
}

.ticketTitleToggle {
  appearance: none;
  border: none;
  background: transparent;
  padding: 2px 0;
  margin-top: 4px;
  font-size: 11px;
  font-weight: 600;
  color: var(--md-sys-color-primary);
  cursor: pointer;
  align-self: flex-start;
}

.ticketTitleToggle:hover {
  text-decoration: underline;
}

.ticketTitlePrefix {
  opacity: 0.86;
}

.ticketTitleReason {
  opacity: 1;
}

.ticketTitleModal {
  font-size: 14px;
  font-weight: 700;
  overflow: visible;
  text-overflow: unset;
  display: block;
  -webkit-line-clamp: unset;
}
.ticketMeta { font-size: 11px; color: rgba(255,255,255,0.72); margin-top: 3px; }
.ticketBtns {
  display: flex;
  gap: 8px;
  align-items: center;
  flex-wrap: wrap;
  justify-content: flex-end;
}
.btn.is-disabled { opacity: 0.55; pointer-events: none; }

/* Stack ticket actions under content on narrow panels (mobile bottom sheet) */
@media (max-width: 520px) {
  .ticket { flex-direction: column; }
  .ticketBtns { justify-content: flex-start; }
}


/* RegMatrix UI */
.regionList { display: flex; flex-direction: column; gap: 8px; }
.regionRow { display: grid; grid-template-columns: 42px 44px 1fr 38px 52px; gap: 10px; align-items: center; padding: 8px 10px; border-radius: 14px; background: var(--md-sys-color-surface-container); border: 1px solid rgba(255,255,255,0.06); }
.regionCode { font-weight: 700; font-size: 12px; }
.regionMeta { font-size: 11px; color: rgba(255,255,255,0.72); }
.regionBar { height: 10px; border-radius: 999px; background: var(--app-border); overflow: hidden; }
.regionFill { height: 100%; background: var(--md-sys-color-primary); border-radius: 999px; }
.regionVal { font-size: 11px; text-align: right; }
.regionTag { font-size: 11px; color: rgba(255,255,255,0.62); text-align: right; }


/* WOW UI */
:root {
  --wow-glow: 0 0 0 1px rgba(255,255,255,0.08), 0 18px 60px rgba(0,0,0,0.55);
  --wow-glow-2: 0 0 0 1px var(--app-border), 0 24px 80px rgba(0,0,0,0.62);
}

body::before {
  content: "";
  position: fixed;
  inset: 0;
  z-index: -2;
  /* Subtle, readable background. No "glassy" vibes or distracting drift. */
  background:
    radial-gradient(1200px 800px at 18% 8%, rgba(138,180,248,0.14), transparent 60%),
    radial-gradient(1000px 700px at 82% 18%, rgba(255,180,171,0.08), transparent 55%),
    linear-gradient(180deg, #0b0e14, #070a10);
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  z-index: -1;
  pointer-events: none;
  opacity: 0.06;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='240' height='240'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='240' height='240' filter='url(%23n)' opacity='.5'/%3E%3C/svg%3E");
  mix-blend-mode: overlay;
}

@keyframes bgDrift {
  from { transform: translate3d(0,0,0) scale(1); }
  to   { transform: translate3d(0,0,0) scale(1); }
}

.card {
  box-shadow: var(--wow-glow);
  transition: transform 140ms ease, box-shadow 140ms ease, border-color 140ms ease;
}

.card:hover {
  transform: translateY(-1px);
  box-shadow: var(--wow-glow-2);
  border-color: var(--app-border);
}

.pill {
  box-shadow: 0 0 0 1px var(--app-border) inset;
}

.btn {
  transition: transform 120ms ease, box-shadow 120ms ease, filter 120ms ease;
}

.btn:active {
  transform: translateY(1px) scale(0.99);
}

.btn.is-active {
  box-shadow: 0 0 0 2px var(--md-sys-color-primary) inset, 0 10px 30px rgba(103,80,164,0.25);
}

/* Tickets */
.ticket {
  position: relative;
  overflow: hidden;
}

.ticket::before {
  content: "";
  position: absolute;
  inset: 0;
  opacity: 0.12;
  background: radial-gradient(500px 200px at 10% 0%, rgba(103,80,164,0.45), transparent 65%),
              radial-gradient(500px 220px at 90% 100%, rgba(0,210,255,0.28), transparent 60%);
  pointer-events: none;
}

.badge {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  height: 18px;
  padding: 0 8px;
  border-radius: 999px;
  font-size: 11px;
  font-weight: 700;
  letter-spacing: 0.2px;
  color: rgba(255,255,255,0.92);
  background: var(--app-border);
  border: 1px solid var(--app-border);
}

.badge.s3 { background: rgba(255, 82, 82, 0.16); border-color: rgba(255, 82, 82, 0.20); }
.badge.s2 { background: rgba(255, 196, 0, 0.14); border-color: rgba(255, 196, 0, 0.18); }
.badge.s1 { background: rgba(0, 210, 255, 0.12); border-color: rgba(0, 210, 255, 0.16); }
.badge.s0 { background: rgba(160, 255, 120, 0.12); border-color: rgba(160, 255, 120, 0.16); }

.ticketMeta { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }

/* Regions */
.regionRow.freeze {
  animation: freezePulse 1.2s ease-in-out infinite;
  border-color: rgba(255, 196, 0, 0.18);
}

@keyframes freezePulse {
  0%   { box-shadow: 0 0 0 0 rgba(255,196,0,0.0); }
  50%  { box-shadow: 0 0 0 2px rgba(255,196,0,0.14); }
  100% { box-shadow: 0 0 0 0 rgba(255,196,0,0.0); }
}

.regionFill {
  transition: width 260ms ease;
}

/* Event feed pop */
.eventItem.pop {
  animation: popIn 160ms ease-out;
}

@keyframes popIn {
  from { transform: translateY(2px); opacity: 0.70; }
  to   { transform: translateY(0); opacity: 1; }
}


.muted { color: var(--app-ink-muted); }
.muted2 { color: var(--app-ink-muted-2); }

select option {
  background: var(--md-sys-color-surface);
  color: var(--md-sys-color-on-surface);
}


/* WOW background for light theme */
html[data-theme="light"] body::before {
  background: radial-gradient(1200px 800px at 15% 10%, rgba(103,80,164,0.18), transparent 60%),
              radial-gradient(900px 600px at 85% 20%, rgba(0,210,255,0.12), transparent 55%),
              radial-gradient(900px 900px at 50% 110%, rgba(255,200,0,0.08), transparent 55%),
              linear-gradient(180deg, #FFFBFE, #F3EDF7);
  opacity: 1;
}

html[data-theme="light"] body::after {
  opacity: 0.06;
  mix-blend-mode: multiply;
}


/* Glass mode intentionally removed: low-transparency UI read as "disabled" and caused confusion. */


/* Minimal input styling matching the buttons/selects */
.input {
  background: color-mix(in oklab, var(--md-sys-color-surface) 88%, black 12%);
  border: 1px solid color-mix(in oklab, var(--md-sys-color-outline) 70%, transparent);
  color: var(--md-sys-color-on-surface);
  border-radius: 12px;
  padding: 10px 12px;
  outline: none;
}
.input:focus {
  border-color: color-mix(in oklab, var(--md-sys-color-primary) 70%, white 30%);
  box-shadow: 0 0 0 3px color-mix(in oklab, var(--md-sys-color-primary) 18%, transparent);
}


.ticketRefactors {
  margin-top: 8px;
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}
.ticketRefactors .btn {
  padding: 6px 10px;
  border-radius: 999px;
  font-size: 12px;
}

.ticketRefactors select {
  max-width: min(360px, 100%);
}

/* A tiny native accordion for refactor-heavy tickets */
.ticketMore {
  margin-top: 8px;
}
.ticketMore summary {
  list-style: none;
  cursor: pointer;
  user-select: none;
}
.ticketMore summary::-webkit-details-marker { display: none; }
.ticketMoreSummary {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  border-radius: 999px;
  padding: 6px 10px;
  border: 1px solid var(--md-sys-color-outline-variant);
  background: var(--md-state-hover);
  font-size: 12px;
}

/* Incident highlighting */
html.incident-hot #incidentsCard,
html.incident-hot #backlogCard {
  border-color: color-mix(in oklab, var(--md-sys-color-error) 55%, var(--md-sys-color-outline-variant));
  box-shadow: 0 0 0 2px color-mix(in oklab, var(--md-sys-color-error) 35%, transparent);
}

.incidentOverlay {
  position: fixed;
  left: 50%;
  transform: translateX(-50%);
  bottom: 16px;
  z-index: 9999;
  width: min(440px, calc(100vw - 32px));
  pointer-events: none;
}

/* --- Profile modal + achievements --------------------------------------- */
.modal {
  position: fixed;
  inset: 0;
  display: grid;
  place-items: center;
  z-index: 80;
}

/*
  We rely on the native `[hidden]` attribute to show/hide modals.
  Because `.modal { display: grid; }` has the same specificity as the browser's
  default `[hidden] { display: none; }`, the `.modal` rule can accidentally win
  and keep the modal (and its backdrop) interactive.

  This rule guarantees that a hidden modal never intercepts pointer events.
*/
.modal[hidden] {
  display: none !important;
}

.modalBackdrop {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.55);
}

.modalPanel {
  position: relative;
  width: min(720px, calc(100vw - 24px));
  max-height: min(80vh, 720px);
  overflow: auto;
  padding: 14px;
  border-radius: 18px;
}

/* --- Refactor modal ----------------------------------------------------- */
.refactorList {
  display: grid;
  gap: 10px;
}

.refactorOption {
  text-align: left;
  width: 100%;
  padding: 10px;
  border-radius: 14px;
  border: 1px solid color-mix(in oklab, var(--md-sys-color-outline) 35%, transparent);
  background: color-mix(in oklab, var(--md-sys-color-surface-container) 80%, transparent);
  color: var(--md-sys-color-on-surface);
  cursor: pointer;
}

.refactorOption:hover {
  background: color-mix(in oklab, var(--md-sys-color-surface-container-highest) 80%, transparent);
}

.refactorOption:focus-visible {
  outline: none;
  box-shadow: 0 0 0 3px color-mix(in oklab, var(--md-sys-color-primary) 18%, transparent);
  border-color: color-mix(in oklab, var(--md-sys-color-primary) 70%, white 30%);
}

.refactorOptionTop {
  display: flex;
  gap: 10px;
  align-items: baseline;
  justify-content: space-between;
}

.refactorOptionTitle {
  font-weight: 650;
  font-size: 13px;
  line-height: 1.2;
}

.refactorOptionChips {
  display: inline-flex;
  gap: 6px;
  flex-wrap: wrap;
  justify-content: flex-end;
}

.chip {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  border-radius: 999px;
  padding: 4px 8px;
  border: 1px solid color-mix(in oklab, var(--md-sys-color-outline-variant) 60%, transparent);
  background: color-mix(in oklab, var(--md-sys-color-surface-variant) 55%, transparent);
  font-size: 11px;
}

.refactorOptionDesc {
  margin-top: 6px;
}

.achList {
  display: grid;
  gap: 10px;
}

.achItem {
  display: grid;
  grid-template-columns: 18px 1fr auto;
  gap: 10px;
  align-items: start;
  padding: 10px;
  border-radius: 14px;
  border: 1px solid color-mix(in oklab, var(--md-sys-color-outline) 35%, transparent);
}

.achItem.is-locked {
  opacity: 0.82;
}

.achBadge {
  width: 18px;
  height: 18px;
  display: grid;
  place-items: center;
  border-radius: 6px;
  background: color-mix(in oklab, var(--md-sys-color-surface-variant) 70%, transparent);
  border: 1px solid color-mix(in oklab, var(--md-sys-color-outline) 25%, transparent);
  font-size: 12px;
}

.achTitle {
  font-weight: 600;
  line-height: 1.2;
}

.achDesc {
  margin-top: 2px;
  opacity: 0.9;
}

.achReward {
  opacity: 0.9;
  white-space: nowrap;
}

.incidentOverlayInner {
  pointer-events: auto;
  border-color: color-mix(in oklab, var(--md-sys-color-error) 55%, var(--md-sys-color-outline-variant));
}

@media (max-width: 980px) {
  .incidentOverlay {
    left: 12px;
    right: 12px;
    top: 12px;
    bottom: auto;
    width: auto;
    transform: none;
  }
}


/* E2E: reduce motion to avoid flaky timing in headless browsers */
html.e2e *, html.e2e *::before, html.e2e *::after {
  animation: none !important;
  transition: none !important;
  scroll-behavior: auto !important;
}
